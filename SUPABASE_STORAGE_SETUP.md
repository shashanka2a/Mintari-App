# Supabase Storage Setup Guide

## Manual Setup Steps

Since the automated script requires proper service role key configuration, follow these manual steps to set up Supabase storage:

### 1. Create Storage Bucket

1. Go to your Supabase project dashboard
2. Navigate to **Storage** in the left sidebar
3. Click **"New bucket"**
4. Configure the bucket:
   - **Name**: `mintari`
   - **Public**: âœ… Check this box
   - **File size limit**: `10485760` (10MB)
   - **Allowed MIME types**: `image/jpeg,image/jpg,image/png`

### 2. Set Up RLS Policies

1. Go to **Authentication** > **Policies** in your Supabase dashboard
2. Navigate to the `storage.objects` table
3. Create the following policies:

#### Policy 1: Users can upload their own files
```sql
CREATE POLICY "Users can upload their own files" ON storage.objects
FOR INSERT WITH CHECK (auth.uid()::text = (storage.foldername(name))[1]);
```

#### Policy 2: Users can view their own files
```sql
CREATE POLICY "Users can view their own files" ON storage.objects
FOR SELECT USING (auth.uid()::text = (storage.foldername(name))[1]);
```

#### Policy 3: Users can update their own files
```sql
CREATE POLICY "Users can update their own files" ON storage.objects
FOR UPDATE USING (auth.uid()::text = (storage.foldername(name))[1]);
```

#### Policy 4: Users can delete their own files
```sql
CREATE POLICY "Users can delete their own files" ON storage.objects
FOR DELETE USING (auth.uid()::text = (storage.foldername(name))[1]);
```

### 3. Test the Setup

1. Run the app: `npm run dev`
2. Navigate to the Upload screen
3. Try uploading a test image
4. Check the Supabase Storage dashboard to see if files appear

### 4. File Organization

Files will be organized in the bucket as:
```
mintari/
â”œâ”€â”€ user-id-1/
â”‚   â”œâ”€â”€ timestamp-random1.jpg
â”‚   â””â”€â”€ timestamp-random2.png
â”œâ”€â”€ user-id-2/
â”‚   â””â”€â”€ timestamp-random3.jpg
â””â”€â”€ ...
```

### 5. Environment Variables

Make sure you have the correct environment variables set:

```bash
# In your .env.local file
NEXT_PUBLIC_SUPABASE_URL=https://mzmoxjueezoukioswfga.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-actual-service-role-key
DATABASE_URL=postgresql://postgres.mzmoxjueezoukioswfga:WFgTyBHJkrLmn5B5@aws-1-us-east-1.pooler.supabase.com:5432/postgres?sslmode=require
```

## Features Implemented

âœ… **Drag & Drop Upload**: Beautiful drag-and-drop interface with progress indicators
âœ… **File Validation**: JPG/PNG only, 10MB max size
âœ… **Error Handling**: Toast notifications for upload failures
âœ… **EXIF Strip Note**: Privacy notice about metadata removal
âœ… **Signed URLs**: Secure upload URLs generated by Supabase
âœ… **Database Integration**: Upload records stored in Prisma database
âœ… **RLS Security**: Row-level security ensures users only access their own files

## API Endpoints

- `POST /api/upload` - Creates signed upload URLs and database records

## Components

- `PhotoUpload` - Main drag-and-drop upload component
- `Progress` - Upload progress indicator
- Error toasts via Sonner

The photo upload system is now fully functional and ready for use! ðŸŽ‰
